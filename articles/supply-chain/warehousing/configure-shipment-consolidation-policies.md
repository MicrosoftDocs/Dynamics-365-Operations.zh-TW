---
title: 設定裝運整合原則
description: 本主題說明如何設定預設和自訂裝運整合原則。
author: GarmMSFT
ms.date: 05/12/2020
ms.topic: article
ms.prod: ''
ms.technology: ''
ms.search.form: WHSShipConsolidationPolicy, WHSShipConsolidationWorkbench, WHSFilterGroupTable, TMSMode, WHSShipmentConsolidation, WHSFilterGenerallyAvail
audience: Application User
ms.reviewer: kamaybac
ms.search.region: Global
ms.author: mirzaab
ms.search.validFrom: 2020-05-01
ms.dyn365.ops.version: 10.0.3
ms.openlocfilehash: f2705300925ae475f00861327b9cea9a97416011
ms.sourcegitcommit: 3b87f042a7e97f72b5aa73bef186c5426b937fec
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/29/2021
ms.locfileid: "8449133"
---
# <a name="configure-shipment-consolidation-policies"></a>設定裝運整合原則

[!include [banner](../includes/banner.md)]

使用貨件整合原則的貨件整合程序，可以在自動和手動發佈到倉庫時執行自動進行貨件整合。 打開此功能後，您必須設定初始原則。 如果未設定原則，則每個銷售明細將生成具有單個負載明細的單獨裝運。

本主題中介紹的案例示意如何設定預設和自訂裝運整合原則。

## <a name="turn-on-the-shipment-consolidation-policies-feature"></a>打開裝運整合原則功能

> [!IMPORTANT]
> 在本主題中說明的[第一種情況](#scenario-1)，您將先設定一個倉庫，以便使用較早的裝運整合功能。 然後，您再提供裝運整合原則。 如此，您可以體驗升級情境的運作方式。 如果您打算使用示範資料環境來完成第一個案例，請不要在執行案例之前打開此功能。

使用 *裝運整合原則* 功能之前，您必須在系統中打開。 管理員可利用[功能管理](../../fin-ops-core/fin-ops/get-started/feature-management/feature-management-overview.md)設定檢查功能狀態，並開啟該功能。 在 **功能管理** 工作區，該功能會依以下方式列出：

- **模組：** *Warehouse Management*
- **功能名稱：** *整合裝運*

## <a name="make-demo-data-available"></a>設定示範資料為可用

本主題中的每個案例都引用了為 Microsoft Dynamics 365 Supply Chain Management 提供的標準示範資料中所包含的值和記錄 。 如果您想在練習時使用此處提供的值，請務必在安裝了示範資料的環境中工作，並在您開始之前將法律實體設定為 **USMF**。

## <a name="scenario-1-configure-default-shipment-consolidation-policies"></a><a name="scenario-1"></a>案例 1：設定預設裝運整合原則

有兩種情況，開啟 *裝運整合原則* 功能後必須設定預設原則的最小數量：

- 您正在升級已包含資料的環境。
- 你正在建立一個全新的環境。

### <a name="upgrade-an-environment-where-warehouses-are-already-configured-for-cross-order-consolidation"></a>在倉庫已設定跨訂單整合的環境，進行升級升級

當您開始此過程時，*貨件整合原則* 功能應該關閉，以模擬使用基本跨訂單整合功能的環境。 您將稍後使用功能管理打開該功能，以便您可以了解如何在升級後設定裝運原則。

在倉庫已設定跨訂單整合的環境中，進行以下步驟設定預設裝運整合原則。

1. 前往 **倉庫管理 \> 設定 \> 倉庫 \> 倉庫**。
1. 在清單中，找到並打開目標的倉庫記錄 (例如，在 **USMF** 示範資料的倉庫 *24*)。
1. 在動作窗格上，選擇 **編輯**。
1. 在 **倉庫** FastTab，設定 **發布到倉庫時整合裝運** 選項為 *是的*。
1. 對所有其他需要整合的倉庫重複步驟 2 到 4。
1. 關閉頁面。
1. 使用 [功能管理](../../fin-ops-core/fin-ops/get-started/feature-management/feature-management-overview.md)開啟 *裝運整合原則* 功能。 在 **功能管理** 工作區，該功能的名稱是 *整合裝運*。
1. 前往 **倉庫管理 \> 設定 \> 發佈到倉庫 \> 貨件整合原則**。 打開該功能後，可能需要重新整理瀏覽器才能看到新的 **裝運整合原則** 功能表項目。
1. 在動作窗格上，選取 **建立預設設定** 建立以下原則：

    - 一種 *銷售訂單* 原則類型的 **CrossOrder** 原則 (假設是您至少有一個倉庫設定為使用較早的整合功能)
    - 一種 *銷售訂單* 原則類型的 **預設** 原則
    - 一種 *轉移出貨* 原則類型的 **預設** 原則
    - 一種 *轉移出貨* 原則類型的 **CrossOrder** 原則 (假設是您至少有一個倉庫設定為使用較早的整合功能)

    > [!NOTE]
    > - 兩個 **CrossOrder** 原則顧及到與前面的邏輯相同的欄位集，但不包含訂單編號欄位。 (該欄位用在依照倉庫、交貨運輸方式和地址等因素將明細整合到裝運中。)
    > - 兩個 **預設** 原則皆顧及到與前面的邏輯相同的欄位集，包含訂單編號欄位。 (該欄位用在依照編號、倉庫、交貨運輸方式和地址等因素將明細整合到裝運中。)

1. 在 *銷售訂單* 原則類型選取 **CrossOrder** 原則，然後在動作窗格上，選取 **編輯查詢**。
1. 在查詢編輯器對話方塊中，注意清單上包含 **發佈到倉庫時整合裝運** 選項設定為 *是的* 的倉庫。 因此，這些倉庫包含在查詢中。

### <a name="create-default-policies-for-a-new-environment"></a>為新環境建立預設原則

執行以下操作，在全新環境中設定預設裝運整合原則。

1. 如果您尚未打開 *裝運整合原則* 功能，請使用[功能管理](../../fin-ops-core/fin-ops/get-started/feature-management/feature-management-overview.md)開啟。 在 **功能管理** 工作區，該功能的名稱是 *整合裝運*。
1. 前往 **倉庫管理 \> 設定 \> 發佈到倉庫 \> 貨件整合原則**。
1. 在動作窗格上，選取 **建立預設設定** 建立以下原則：

    - 一種 *銷售訂單* 原則類型的 **預設** 原則
    - 一種 *轉移出貨* 原則類型的 **預設** 原則

    > [!NOTE]
    > 兩個 **預設** 原則皆顧及到與前面的邏輯相同的欄位集，包含訂單編號欄位。 (該欄位用在依照編號、倉庫、交貨運輸方式和地址等因素將明細整合到裝運中。)

## <a name="scenario-2-configure-custom-shipment-consolidation-policies"></a>案例 2：設定自訂裝運整合原則

此方案說明如何設定自訂裝運整合原則。 當裝運整合受多個條件影響，自訂原則可以支援此類複雜的業務需求。 對於本案例後面的每個範例原則，包含對業務案例的簡短描述。 這些範例原則設定的順序應能確保對查詢有金字塔式評估。 (換句話說，條件最多的原則應該被評估為具有最高優先級。)

### <a name="turn-on-the-feature-and-prepare-master-data-for-this-scenario"></a>開啟功能並為此案例準備主資料

在完成此案例中的練習之前，您必須開啟功能並準備執行篩選必須的主資料，如以下小節所述。 (這些先決條件也適用於[如何使用裝運整合原則的範例場景](#example-scenarios)。)

#### <a name="turn-on-the-feature-and-create-the-default-policies"></a>打開該功能並建立預設原則

使用功能管理打開功能 (如果您尚未打開它)，並建立在[案例 1](#scenario-1)中說明的預設整合原則。

#### <a name="create-two-new-product-filter-codes"></a>建立兩個新的產品篩選代碼

1. 前往 **倉庫管理\>設定\>產品篩選\>產品篩選**，並新增兩個產品篩選：

    - 產品篩選 1：

        - **篩選代碼：** *易燃*
        - **篩選標題：** *代碼 4*

    - 產品篩選 2：

        - **篩選代碼：** *易爆*
        - **篩選標題：** *代碼 4*

1. 請前往 **產品資訊管理 \> 產品 \> 已發佈的產品**。
1. 打開品項編號為 *M9200* 的產品。 (選定的產品必須啟用進階倉庫\[WMS\]程序，並且此產品已在 **USMF** 示範資料中預先啟用 WMS 程序。)
1. 在 **倉庫** FastTab 中，將 **代碼 4** 欄位設為 *易燃*。
1. 關閉頁面。
1. 打開品項編號為 *M9201* 的產品。 (該產品也在 **USMF** 示範資料中預啟用預先啟用了 WMS 流程。)
1. 在 **倉庫** FastTab 中，將 **代碼 4** 欄位設為 *易爆*。
1. 關閉頁面。

#### <a name="create-a-new-transportation-mode-of-delivery"></a>建立一種新的交貨運輸方式

1. 移至 **運輸管理 \> 設定 \>承運人\> 模式**。
1. 建立將在整合查詢中使用的運輸方式，並將其命名 *航空公司*。
1. 移至 **運輸管理 \> 設定 \> 承運人 \> 裝運承運人**。
1. 建立具有以下設定的承運業者：

    - **承運業者：** *航空公司*
    - **名稱：** *航空公司*
    - **模式：** *航空公司*

1. 在新承運業者的 **服務** FastTab，新增具有以下設定的列：

    - **貨運服務：** *空運*
    - **運輸方式：** *空運*

1. 在動作窗格上，選擇 **儲存**。

    > [!NOTE]
    > 當您儲存新的承運業者時，**服務** 網格中新列的 **交貨模式** 欄位自動設定為 *Airwa-Air*。 當您在銷售訂單使用 *Airwa-Air* 交貨方式，相關裝運將採用 *航空公司* 運輸方式。

#### <a name="create-an-order-pool"></a>建立訂單池

1. 請前往 **銷售和行銷 \> 設定 \> 銷售訂單 \> 訂單池**。
1. 建立將用於整合查詢的訂單池。 此訂單池應具有以下設定：

    - **池：** 輸入一個尚未被任何池使用的整數。
    - **名稱：** *ShipCons*

1. 前往 **銷售與營銷 \> 客戶 \> 所有客戶**。
1. 打開帳戶編號為 *US-003* 的客戶。
1. 在 **銷售訂單預設值** FastTab，將您剛剛創建的訂單池設定到 **銷售訂單池** 欄位中。
1. 關閉頁面，然後具有帳戶編號 *US-004* 的客戶重複步驟 4、步驟 5。

### <a name="create-example-policy-1"></a>建立範例原則 1

在本範例中，您將建立一個 *客戶+模式* 原則，以用於以下業務案例：

- 該原則將查詢特定客戶帳戶 (*US-001*) 和特定的交貨方式 (*Airwa-Air*)。
- 與未結裝運的整合已關閉。
- 依訂單識別碼的整合已完成。 (換句話說，每個訂單、每個倉庫等都會有單獨的裝運。)

進行以下步驟為此業務案例建立裝運整合原則。

1. 前往 **倉庫管理 \> 設定 \> 發佈到倉庫 \> 貨件整合原則**。
1. 設定 **原則類型** 欄位為 *銷售訂單*。
1. 在動作窗格上，選擇 **新增** 建立一原則，並為其設定以下值：

    - **原則名稱；** *CustomerMode*
    - **原則說明：** *客戶帳戶和交貨模式*

1. 將 **與未結貨物整合** 選項保留為 *否*。
1. 在動作窗格上，選擇 **儲存**。
1. 在 **整合欄位** FastTab 的 **其餘欄位** 清單中，選取 **欄位名稱** 欄位設為 *交貨模式* 的列。
1. 選取 **新增** 按鈕 ![右箭頭。](media/forward-button.png) 將欄位移動到 **選定欄位** 清單。
1. 在動作窗格上，選擇 **編輯查詢**。
1. 在查詢編輯器對話方塊中，在 **範圍** 索引標籤，在網格中，找到 **欄位** 欄位設置為 *客戶帳戶* 的列，並將該列 **準則** 欄位設定為 *US-001*。
1. 選取 **新增** 將具有以下設定的列加入網格：

    - **資料表：** *訂單明細*
    - **衍生資料表：** *訂單明細*
    - **欄位：** *交貨模式*
    - **準則：** *Airwa-Air*

1. 選擇 **確定** 關閉對話方塊。

> [!NOTE]
> 對於此業務案例，*US-001* 客戶的訂單明細，若使用 *Airwa-Air* 交貨方式不會跨訂單整合。 此原則旨在順序中首先使用，以防止為該客戶整合所有其他交貨方式的裝運。

### <a name="create-example-policy-2"></a>建立範例原則 2

在本範例中，您將建立一個 *危險貨物* 原則，以用於以下業務案例：

- 該原則將查詢特定篩選代碼 (*危險物*) 和特定的交貨方式 (*Airwa-Air*)。
- 與未結裝運的整合已開啟。
- 跨訂單的整合已完成。 (即每個帳戶、倉庫等會有單獨的狀運，但僅限於查詢中指定的品群組內。)

進行以下步驟為此業務案例建立裝運整合原則。

1. 前往 **倉庫管理 \> 設定 \> 發佈到倉庫 \> 貨件整合原則**。
1. 設定 **原則類型** 欄位為 *銷售訂單*。
1. 在動作窗格上，選擇 **新增** 建立一原則，並為其設定以下值：

    - **原則名稱：** *品項類型*
    - **原則說明：** *跨訂單整合相同類型的品項*

1. 將 **與未結貨物整合** 選項設定為 *是*。
1. 在動作窗格上，選擇 **儲存**。
1. 在 **整合欄位** FastTab 的 **其餘欄位** 清單中，選取 **欄位名稱** 欄位設為 *交貨模式* 的列。
1. 選取 **新增** 按鈕 ![右箭頭。](media/forward-button.png) 將欄位移動到 **選定欄位** 清單。
1. 在動作窗格上，選擇 **編輯查詢**。
1. 在查詢編輯器對話方塊中，在 **聯結** 索引標籤，展開並在樹狀圖上選取 **資料表\>負載詳細資料**。
1. 選取 **新增資料表聯結**。
1. 在出現的關係網格中，找到 **關係** 欄位設置為 *倉庫品項編號 (品項編號 )* 的列並選取，然後選取 **選取**。 
1. 在 **範圍** 索引標籤，選擇 **新增** 將具有以下設定的列加入網格：

    - **資料表：** *倉庫品項編號*
    - **衍生資料表：** *倉庫品項編號*
    - **欄位：** *代碼 4*
    - **準則：** *易燃*

1. 選擇 **確定** 關閉對話方塊。

> [!NOTE]
> 對於此業務案例，品項具有特定篩選代碼 (即，**代碼 4** 欄位設訂為 *易燃*) 的所有訂單明細將與訂單中相同類型的其他品項整合。 如果同一帳戶、倉庫和品項群組有未結裝運，則對其附加新明細將。

### <a name="create-example-policy-3"></a>建立範例原則 3

在本範例中，您將建立一個 *客戶申請* 原則，以用於以下業務案例：

- 該原則將查詢特定客戶帳戶。
- 與未結裝運的整合已開啟。
- 整合是跨訂單完成的，但其依據是客戶申請。 (即依據相同的客戶要求編號和倉庫，將多個訂單合併裝運。)

進行以下步驟為此業務案例建立裝運整合原則。

1. 前往 **倉庫管理 \> 設定 \> 發佈到倉庫 \> 貨件整合原則**。
1. 設定 **原則類型** 欄位為 *銷售訂單*。
1. 在動作窗格上，選擇 **新增** 建立一原則，並為其設定以下值：

    - **原則名稱；** *CustomerOrderNo*
    - **原則說明：** *依據客戶訂購單整合明細*

1. 將 **與未結貨物整合** 選項設定為 *是*。
1. 在動作窗格上，選擇 **儲存**。
1. 在 **整合欄位** FastTab 的 **其餘欄位** 清單中，選取 **欄位名稱** 欄位設為 *客戶申請* 的列。
1. 選取 **新增** 按鈕 ![右箭頭。](media/forward-button.png) 將欄位移動到 **選定欄位** 清單。
1. 在 **其餘欄位** 清單中，選取 **欄位名稱** 欄位設為 *交貨模式* 的列。
1. 選取 **新增** 按鈕 ![右箭頭。](media/forward-button.png) 將欄位移動到 **選定欄位** 清單。
1. 在動作窗格上，選擇 **編輯查詢**。
1. 在查詢編輯器對話方塊中，在 **範圍** 索引標籤，找到 **欄位** 欄位設置為 *客戶帳戶* 的列，並將該列的 **準則** 欄位設定為 *US-001*。
1. 選擇 **確定** 關閉對話方塊。

> [!NOTE]
> 對於此業務案例，不管銷售訂單編號，只要銷售訂單具有相同客戶申請編號，所有訂單明細都將整合到一個裝運中。 (客戶申請編號被用作客戶的訂購單 \[PO\] 編號。) 如果有相同帳戶、倉庫和客戶申請的未結裝運，將其附加上新明細。 如果客戶在一天內多次發送具有相同訂購單編號的額外訂單明細並希望將所有明細合併到一個裝運中，則可以使用此策略。 (換句話說，將有一張提單和一張裝箱單。)

### <a name="create-example-policy-4"></a>建立範例原則 4

在本範例中，您將建立一個 *客戶容許整合* 原則，以用於以下業務案例：

- 該原則將查詢特定的訂單池，找出接受整合裝運的客戶。
- 與未結裝運的整合已關閉。
- 使用預設 CrossOrder 原則選定的欄位，以完成跨訂單整合 (複製之前的 **發布到倉庫時整合裝運** 核取方塊)。

- 您可以選取不同的訂單池來覆寫銷售訂單上的規則。

進行以下步驟為此業務案例建立裝運整合原則。

1. 前往 **倉庫管理 \> 設定 \> 發佈到倉庫 \> 貨件整合原則**。
1. 設定 **原則類型** 欄位為 *銷售訂單*。
1. 在動作窗格上，選擇 **新增** 建立一原則，並為其設定以下值：

    - **原則名稱：** *訂單池*
    - **原則說明：** *依據訂單池跨訂單整合*

1. 將 **與未結貨物整合** 選項保留為 *否*。
1. 在動作窗格上，選擇 **儲存**。
1. 在 **整合欄位** FastTab 的 **其餘欄位** 清單中，選取 **欄位名稱** 欄位設為 *交貨模式* 的列。
1. 選取 **新增** 按鈕 ![右箭頭。](media/forward-button.png) 將欄位移動到 **選定欄位** 清單。
1. 在動作窗格上，選擇 **編輯查詢**。
1. 在查詢編輯器對話方塊，**範圍** 索引標籤，選擇 **新增** 將具有以下設定的列加到網格：

    - **資料表：** *銷售訂單*
    - **衍生資料表：** *銷售訂單*
    - **欄位：** *池*
    - **準則：** *ShipCons*

1. 選擇 **確定** 關閉對話方塊。

> [!NOTE]
> 對於此業務案例，相同帳戶、倉庫和運輸運輸方式且屬於同一訂單池的銷售訂單，其訂單明細將整合為一個裝運。 除了訂單池外，您還可以使用任何其他欄位來區分出一組客戶並依預設使用其銷售訂單標頭。 如果是客戶而非倉庫提出整合需求，您可以使用這種方法。 (在前面的整合邏輯中，倉庫提出了整合的需求。)

### <a name="create-example-policy-5"></a>建立範例原則 5

在本範例中，您將建立一個 *倉庫容許整合* 原則，以用於以下業務案例：

- 該原則將查詢特定的訂單池，找出接受整合裝運的倉庫。
- 與未結裝運的整合已關閉。
- 使用預設 CrossOrder 原則選定的欄位，以完成跨訂單整合 (複製之前的 **發布到倉庫時整合裝運** 核取方塊)。

通常，可以使用您在[案例 1](#scenario-1)建立的原則，解決此業務案例。 但是，您也可以按照以下步驟手動建立類似的原則。

1. 前往 **倉庫管理 \> 設定 \> 發佈到倉庫 \> 貨件整合原則**。
1. 設定 **原則類型** 欄位為 *銷售訂單*。
1. 在動作窗格上，選擇 **新增** 建立一原則，並為其設定以下值：

    - **原則名稱：** *Cross-order*
    - **原則說明：** *特定倉庫的跨訂單整合*

1. 將 **與未結貨物整合** 選項保留為 *否*。
1. 在動作窗格上，選擇 **儲存**。
1. 在 **整合欄位** FastTab 的 **其餘欄位** 欄位中，選取 **欄位名稱** 欄位設為 *交貨模式* 的列。
1. 選取 **新增** 按鈕 ![右箭頭。](media/forward-button.png) 將欄位移動到 **選定欄位** 清單。
1. 在動作窗格上，選擇 **編輯查詢**。
1. 在查詢編輯器對話方塊中，在 **範圍** 索引標籤，找到 **欄位** 欄位設置為 *倉庫* 的列，並將該列的 **準則** 欄位設定為 *61, 63*。
1. 選擇 **確定** 關閉對話方塊。

### <a name="set-the-order"></a>設定訂單

現在您已經建立了所有策略，您必須設立套用它們的順序。 要使用類似金字塔的方法，其中條件最多的原則被評估為具有最高優先級，請按照以下步驟操作。

1. 前往 **倉庫管理 \> 設定 \> 發佈到倉庫 \> 貨件整合原則**。
1. 設定 **原則類型** 欄位為 *銷售訂單*。
1. 選取在左側欄中列出的每個原則，然後使用動作窗格上的 **上移** 和 **下移** 的按鈕按，以下順序排列原則：

    1. 客戶模式
    1. 品項類型
    1. CustomerOrderNo
    1. 訂單池
    1. 跨訂單
    1. 預設

## <a name="example-scenarios-of-how-to-use-shipment-consolidation-policies"></a><a name="example-scenarios"></a>如何使用裝運整合原則的範例案例

以下案例說明如何使用閱讀本主題時建立的裝運整合原則。 每個案例逐步引導您認識一個裝運整合程序，其自動和手動發佈到倉庫時使用裝運整合原則：

- 案例 1：[使用自動發布銷售訂單在裝運發布到倉庫時整合](../warehousing/consolidate-shipments-automatic.md)
- 案例 2：[當裝運整合原則在「發布到倉庫」頁面被覆寫時整合裝運](../warehousing/consolidate-shipments-release-to-warehouse-override.md)
- 案例 3：[在負載規劃工作台使用發佈到倉庫來整合裝運](../warehousing/consolidate-shipments-load-planning-workbench.md)
- 案例 4: [使用裝運整合工作台整合裝運](../warehousing/consolidate-shipments-manual-workbench.md)
- 案例 5: [使用整合裝運頁面手動整合裝運](../warehousing/consolidate-shipments-manual-form.md)


## <a name="additional-resources"></a>其他資源

- [裝運整合原則](about-shipment-consolidation-policies.md)


[!INCLUDE[footer-include](../../includes/footer-banner.md)]