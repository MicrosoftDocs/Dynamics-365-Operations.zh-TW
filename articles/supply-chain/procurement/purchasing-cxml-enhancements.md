---
title: 採購 cXML 增強功能
description: 採購 cXML 增強功能以現有的外部目錄功能 PunchOut 為基礎，該功能用於採購申請。
author: Henrikan
ms.date: 08/03/2020
ms.topic: article
ms.prod: ''
ms.technology: ''
ms.search.form: CatCXMLParameters, CatCXMLPurchRequest
audience: Application User
ms.reviewer: kamaybac
ms.search.region: Global
ms.author: henrikan
ms.search.validFrom: 2020-08-03
ms.dyn365.ops.version: 10.0.13
ms.openlocfilehash: 2942b141eb3a5b83fb39b0de721bae60c074e01c
ms.sourcegitcommit: f5885999e008a49fe072d95f15e239905c24918a
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 12/08/2021
ms.locfileid: "8449511"
---
# <a name="purchasing-cxml-enhancements"></a>採購 cXML 增強功能

[!include [banner](../includes/banner.md)]

_採購 cXML 增強功能_ 以[現有用於採購申請的外部目錄功能](set-up-external-catalog-for-punchout.md) 為基礎。 這個現有功能的名稱為 _PunchOut_。 儘管訂購單不必源自採購申請，但訂購單上的供應商與用於傳送訂購單文件的參數之間必須有所關聯。

## <a name="turn-on-the-purchasing-cxml-enhancements-feature"></a>開啟採購 cXML 增強功能

若要開啟該功能，請開啟 **[功能管理](../../fin-ops-core/fin-ops/get-started/feature-management/feature-management-overview.md)** 頁面，然後搜尋名稱為 *採購 cXML 增強功能* 的功能。 選取該功能，然後選擇 **立即啟用** 來開啟功能。 (從 Supply Chain Management 版本 10.0.21 開始，此功能為預設開啟)。

開啟功能後，建議您在以下三個區域進行設定：

- **[cXML 參數](#cxml-parameters)** – 使用這些設定為傳送採訂購單的功能設定一些全域參數。
- **[供應商設定](#vendor-setup)** – 若要在預設情況下將商用延伸標示語言 (cXML) 用於為所有供應商建立的所有新訂購單，請針對所需的供應商，將 **透過 cXML 傳送訂購單** 選項設成 _是_。
- **[外部目錄](#external-catalog-setup)** – 使用新的 **訂單屬性** 設定以定義訂購單文件的格式及傳送方式。

下圖概要說明這項設定。

![設定 cXML 功能的區域。](media/cxml-settings-areas.png "設定 cXML 功能的區域")

此外，您必須設定[訂購單要求批次作業](#po-batch)。 這個批次作業用於傳送已確認的訂購單。

## <a name="set-up-global-cxml-parameters"></a><a name="cxml-parameters"></a>設定全域 cXML 參數

使用 **cXML 參數** 頁面設定要套用至傳送訂購單的一些全域設定。

![cXML 參數頁面](media/cxml-parameters.png "cXML 參數頁面")

前往 **採購和開源\>設定\>cXML 管理\>cXML 參數**，並設定以下參數：

- **cXML 測試模式** – 這個全域參數影響從批次作業實際傳送訂購單的方式。 選擇下列其中一個值：

    - **測試** – 在此模式下，系統可以執行批次作業，產生訊息的 XML 文件，但不會傳送該文件。 系統會將該文件儲存在訂購單要求中以供審查。 如果您處於初始實作，且想要查看資料如何輸入 cXML 訊息，則適合採用此模式。 您可能也會想要產生可以傳送給供應商以進行初始驗證的樣本訊息。
    - **即時** – 在此模式下，該功能使用[外部目錄設定](#external-catalog-setup)，以實際方式將每個文件傳送給供應商。

- **傳送採購要求更新** – 若要傳送訂購單的更新訊息，請將此選項設為 *是*。 將設定設成 *否* 則可防止系統傳送更新訊息。 大多數供應商偏好不接收更新訊息。 如果客戶需要變更訂購單，供應商通常會要求客戶透過電話或電子郵件與他們聯繫。 這個參數是全域參數，不能針對每個供應商的外部目錄指定覆寫內容。 如果您在訂購單上發布第二次確認，則訂購單會標記為已更新，但第一次確認已由供應商發送並確認。 若有第二次確認，但第一次確認尚未發送，則第二次確認會視為新文件。 您可以根據需要多次確認訂購單，直到傳送一次確認為止。 下一個確認將會視為更新訊息。
- **傳送採購要求更新刪除** – 若要傳送訂購單的刪除訊息，請將此選項設為 *是*。 將設定設成 *否* 則可防止系統傳送更新訊息。 大多數供應商偏好不接收刪除訊息。 如果客戶誤傳訂購單，供應商通常會要求客戶透過電話或電子郵件與他們聯繫。 這個參數是全域參數，不能針對每個供應商的外部目錄指定覆寫內容。 如果您在 Supply Chain Management 中取消訂購單，訂購單將會標記為已刪除。
- **封存檔案** – 指定要匯出和儲存封存 cXML 文件的檔案路徑。 當您從 **訂購單要求** 頁面執行清除功能時，系統會使用此路徑。
- **街道文字行的最大字元數** – 輸入 cXML 文件中地址街道欄位可使用的最大字元數量。 此全域參數會影響所有供應商，除非您在外部目錄屬性上指定覆寫內容。

## <a name="set-up-vendor-purchase-orders-to-use-cxml"></a><a name="vendor-setup"></a>設定供應商訂購單以使用 cXML

每次您確認訂購單時，只要該訂購單的 **透過 cXML 傳送訂購單** 選項設為 _是的_，系統就會自動產生 cXML 訊息，並將訊息傳送給與訂購單相關的供應商。 有兩種方法可以控管這個訂購單選項：

- 若要設定供應商，讓 cXML 自動用於從申請建立的所有新訂購單，請前往 **採購和開源\>供應商\>所有供應商**，然後選取或建立供應商以開啟其詳細資料頁面。 然後，在 **訂購單預設值** FastTab 上，將 **透過 cXML 傳送訂購單** 選項設為 _是_。 如果 cXML 也需要自動用於 **不是** 從申請建立的新訂購單，您也必須針對相關的外部目錄，將 **ENABLEMANUALPO** 訂購屬性設為 _True_，如同本主題後續的[設定訂單屬性](#set-order-properties)章節所述。
- 針對個別訂購單，請前往 **採購和開源 \> 訂購單 \> 所有訂購單**，並選取或建立訂購單以開啟其詳細資料頁面。 切換到 **標題** 檢視，然後在 **設定** FastTab 上，根據需求設定 **透過 cXML 傳送訂購單** 選項。

![供應商訂購單的預設設定。](media/cxml-order-defaults.png "供應商訂購單的預設設定")

## <a name="set-up-an-external-catalog-to-use-cxml"></a><a name="external-catalog-setup"></a>設定外部目錄以使用 cXML

在 **外部目錄** 頁面，您可以為每個目錄設定 PunchOut 功能和傳送訂購單的功能。 若要尋找相關設定，請前往 **採購和開源 \> 目錄 \> 外部目錄**。 從[像往常一般設定每個目錄](set-up-external-catalog-for-punchout.md)開始進行。 這項程序包含指派供應商、選擇供應商可供應的類別以及啟用目錄。 然後，設定本節中說明的其他設定。

> [!NOTE]
> 當您確認可以透過 cXML 傳送的訂購單時，系統會尋找與訂購單相關的供應商，然後尋找與該供應商相關的第一個有效外部目錄。 接著，系統會使用該外部目錄中的設定來傳送訂購單。 如果已設定多個外部目錄，系統會根據訂購單上的供應商，只使用所找到的第一個外部目錄。 因此，我們建議您只為每個供應商建立一個外部目錄。

![外部目錄設定。](media/cxml-supplier-catalog.png "外部目錄設定")

### <a name="set-the-punchout-protocol-type"></a>設定 PunchOut 通訊協定類型

在 **外部目錄** 頁面的 **一般** FastTab 上，將 **PunchOut 通訊協定類型** 欄位設為 _cXML_。 除非合作夥伴擴展了功能並在擴充功能中提供額外選項，否則此選項是唯一可用的選項。

如果您也將目錄用於 PunchOut，則也必須[設定訊息格式](set-up-external-catalog-for-punchout.md)。 訊息格式是用在來自申請的 PunchOut 交易中建立與供應商的連接。 傳送訂購單後，訂單屬性會用於建立與供應商的連接。

### <a name="set-the-order-properties"></a><a name="set-order-properties"></a>設定訂單屬性

_採購 cXML 增強功能_ 為外部目錄增加了一個新的 **訂單屬性**。 這個 FastTab 提供了一個網格架構，您可以在其中定義訂單屬性。 此外，還提供一個工具列。 這個工具列包含以下三個按鈕，可用於管理訂單屬性：

- **預設屬性** – 設定新目錄時，選取此按鈕可將常用屬性的預先定義集合加進網格。
- **新** – 將新屬性加進網格。
- **刪除** – 從網格中刪除目前選定的屬性。 如果您不小心刪除預設屬性，請選擇 **預設屬性** 以還原所有缺失的屬性。

每次在網格中加入一或多個屬性時，請使用正確的欄為每個屬性指定一個值。

使用以下方式使用預設屬性：

- **BUYER \_COOKIE** – 此追蹤欄位可用於表示貴公司的特定資訊。 除非您與供應商就如何使用此屬性達成協議，否則在傳送訂購單時，此屬性並沒有非常重要。 因此，建議您將該屬性設成一個簡單的值。
- **DELIVERTO** – 在訂購單的文件中輸入收貨地址後，系統會使用 **注意訊息** 欄位來設定 XML 訊息中的 **DeliverTo** 欄位。 如果您要求此值為要求者名稱，而且您要在訂購單標題上設定要求者欄位，請為此屬性輸入名為 _REQUESTER_ 的值，以便將要求者名稱輸入 XML 中的 **DeliverTo** 欄位。 在這種情況下，使用的主要電子郵件地址和電話號碼將來自要求者而非訂購者。
- **DEPLOYMENTMODE** –根據供應商的要求設定此屬性。 這些值通常是 _PRODUCTION_ 或 _TEST_。 請根據您與供應商的聯絡情形來設定值。 通常，值必須與 **ORDERCHECKURL** 值 (供應商利用這個值標示為測試或生產系統) 後面的預期系統相符。
- **FIXEDBILLADDRESSID** - XML 中的 **addressID** 欄位已設定時，系統會選取地址上指定的位置。 如果您傳達給供應商的識別碼值基於某種原因，與地址位置上的值不同，則您可以透過在此處指定值來強制覆寫。 假設是您只與供應商使用一個地址，並且該地址是在供應商的系統中設定。 帳單地址是在 Supply Chain Management 中為法律實體指定的主要發票地址。
- **FIXEDSHIPADDRESSID** - XML 訊息中的 **addressID** 欄位已設定時，系統會選取地址上指定的位置。 如果您傳達給供應商的識別碼值基於某種原因，與地址位置上的值不同，則您可以透過在此處指定值來強制覆寫。 假設是您只與供應商使用一個地址，並且該地址是在供應商的系統中設定。 運送地址是在訂購單標題上指定的地址。 大多數供應商只接受標題地址，而不接受文字行地址。 雖然 XML 中有文字行地址欄位，但這些欄位會設定成標題地址。
- **FROM\_DOMAIN** – 輸入用於傳送訂購單文件的值。 這個值是由您的供應商提供。
- **FROM\_IDENTITY**–輸入用於傳送訂購單文件的值。 這個值是由您的供應商提供。
- **ORDERCHECKURL**–輸入訂購單文件的傳輸目的地網址。 此網址以`https://`作為開頭，並由您的供應商提供。
- **PAYLOAD\_ID**–根據目前供應商的業務流程要求，輸入承載識別碼的首碼值。
- **SENDER\_DOMAIN**–輸入用於傳送訂購單文件的值。 這個值是由您的供應商提供。
- **SENDER\_IDENTITY**–輸入用於傳送訂購單文件的值。 這個值是由您的供應商提供。
- **SHARED\_SECRET**–輸入用於傳送訂購單文件的值。 這個值是由您的供應商提供。
- **STREETLENGTH**–輸入一個數字，用來表示供應商對於街道名稱所接受的最大字元數。 如果在此處輸入值，該值會覆寫 **cXML 參數** 頁面上指定的值。 系統會移除換行符號和空格，以嘗試讓 Supply Chain Management 中的標準地址適合此處指定的字元數。 任何額外的字元都會遭到截斷。
- **TO\_DOMAIN**–輸入用於傳送訂購單文件的值。 這個值是由您的供應商提供。
- **TO\_IDENTITY**–輸入用於傳送訂購單文件的值。 這個值是由您的供應商提供。
- **USERAGENT**–輸入一個值來標識您正在使用的系統。 例如，輸入 _Dynamics 365 Supply Chain Management_。
- **VERSION**–如果供應商要求提供這項資訊，請輸入 cXML 版本號碼。 預設版本為 *1.2.008*。 這個版本運作情況穩定，且為大多數供應商接受。
- **RESPONSETEXT**–輸入您希望訂單傳送後，供應商在 cXML 回應訊息中傳回的任何自訂文字。 這樣一來，系統就可以將訊息標記為 _已確認_。 如果回應與您在此處輸入的標准文字或客戶文字不相符，要求將會標記為 _錯誤_。
- **RESPONSETEXTSUB** –如果您想在供應商回應文字中搜尋 **RESPONSETEXT** 欄位中指定的值，請將此屬性設定為 _TRUE_。 例如，供應商可能會在回應中傳回包含「OK」的長字串。 在這種情況下，您可以在 **RESPONSETEXT** 欄位中輸入 _OK_，並將 **RESPONSETESTSUB** 設成 _TRUE_，以搜尋回應中的所有「OK」。 然後可以將訂單設定為 _已確認_。
- **CONTENTTYPE** –在一般目錄設定中，您不需要設定此屬性。 如果您在傳送訂購單時收到來自供應商系統的伺服器 500 錯誤，則可以將此屬性設為 _FALSE_ 以進行測試。 該值會變更網頁要求中的設定，且可能會讓消息能夠傳送到某些平台。
- **ENABLEHEADERS** –將此屬性設為 _TRUE_，以將標題與訂購單一起傳送。 只有當供應商要求時，您才必須設定此屬性。 如果將此屬性設為 _TRUE_，請根據供應商提供的名稱新增額外的自訂屬性，並在屬性前面加上 _H\__。 典型例子包括 **H\_USERID**、**H\_PASSWORD**、**H\_RECEIVERID**，以及  **H\_ACTIONREQUEST**。 以下自訂屬性包含在預設屬性中：

    - **H\_USERID** –如果交易合作夥伴要求您將使用者識別碼作為網址的一部分傳送，以提交訂購單，請在此處輸入值。
    - **H\_PASSWORD** –如果交易合作夥伴要求您將密碼作為網址的一部分傳送，以提交訂購單，請在此處輸入值。

- **ENABLEMANUALPO** –如果此屬性設定為 _TRUE_，當使用者手動建立訂購單時 (而不是從申請開始操作)，這些訂購單會繼承 **透過 cXML 傳送訂購單** 中的供應商設定。 如果未設定此屬性，或者將其設為 _FALSE_，系統就不會針對手動建立的訂購單，在訂購單標題上設定 **透過 cXML 傳送訂購單** 選項。 對於從申請建立的訂購單，無論此屬性的設定如何，**透過 cXML 傳送訂購單** 的設定一律會繼承自供應商。 若需詳細資訊，請參閱本主題前面部分的[設定供應商訂購單以使用 cXML](#vendor-setup)。
- **PUNCHOUTPOONLY**–如果此屬性設定為 _TRUE_， 只有從 PunchOut 程序中建立的採購申請文字行，才會訂購單標題上的選項設定 **透過 cXML 傳送訂購單**。 另外，訂購單上所有行項的採購申請行類型必須是 _外部目錄項目_。 否則，系統將無法建立 cXML 訂購單。
- **PUNCHOUTSHIPTO** –如果此屬性設為 _TRUE_，法律實體的預設地址會在使用者開啟外部目錄時，新增到 PunchOut 設定要求訊息中。 系統會加入此地址作為 **ShipTo** 地址。 供應商會使用 **ShipTo** 地址來顯示根據公司位置設定的價格。
- **TRACEPUNCHOUT** –如果您在嘗試從申請瀏覽外部目錄時收到錯誤訊息，請將此屬性設置為 _TRUE_。 接著，系統會為 **PunchOut設定要求** 和 **PunchOut回應** 訊息填寫追蹤資訊，兩者是在 Supply Chain Management 和供應商網站之間傳送的訊息。 您可以在 **cXML 購物車訊息日記帳** 頁面上查看這項資訊，您可以從 **外部目錄設定** 頁面針對您有問題的廠商目錄開啟此頁面。 只有在您進行故障排除時，才需要將此屬性設為 _TRUE_，因為此屬性會為每個 PunchOut，在資料庫上建立大量的效能負荷。 若需詳細資訊，請參閱本主題後面的[查看外部目錄 PunchOut 的 cXML 購物車訊息記錄](#message-log)。
- **REPLACENEWLINE** – 如果您遇到問題是因為供應商的系統正在傳送包含換行字元 (\\ n) 的  **PunchOutResponse** 訊息，請將此屬性設置為 _TRUE_。 如果供應商的訊息是透過中介軟體或採購中樞解析的，則可能會出現此問題。 如果您在使用新的供應商設定時遇到問題，請將 **TRACEPUNCHOUT** 屬性設為 _TRUE_，以查看 **PunchOutResponse** 訊息，並判斷 XML 標記是否由換行字元分隔。
- **POCOMMENTS** – 如果您希望 cXML 文件包含在 Supply Chain Management 中附加到採購訂單的附註，請將此屬性設為 _TRUE_。 附件文字包含在訂購單訊息的標題註解中。 若需進一步了解系統如何選擇和處理這些附件，請參閱本主題後面的[將附註附加到訂購單](#attach-po-notes)。
- **VENDCOMMENTS** –如果您希望 cXML 文件包含在 Supply Chain Management 中附加到訂購單的附註，請將此屬性設為 _TRUE_。 附件文字包含在訂購單訊息的標題註解中。 若需進一步了解系統如何選擇和處理這些附件，請參閱[將附註附加到訂購單](#attach-po-notes)部分。
- **CLEANAMP** – 如果您在嘗試向供應商執行 PunchOut 時收到錯誤訊息，並且供應商的傳回網址包含錯誤編碼的 & 符號 (\&)，請將此屬性設定為 _TRUE_ 。
- **PUNCHOUTTZ**– 如果您正在合作的供應商透過國際標準化組織 (ISO) 8601 標準對 PunchOut 要求訊息的日期/時間進行特定驗證，將此屬性設為 _TRUE_。 Supply Chain Management 在 **PunchOutSetupRequest** 訊息中使用國際標準時間 (UTC) 日期。 因此，當您將此屬性設為 _TRUE_ 時，系統會將 *+00:00* 加入到日期/時間格式。
- **WMSADDRESSID**–將此屬性設為 _TRUE_，以在傳送給供應商的訂購單要求的 **ShipTo** 地址中， 使用訂購單標題上的倉庫編號作為 **addressID** 值。 如果您為 **FIXEDSHIPADDRESSID** 屬性設定值，則該值的優先順序會大於此值。 因此，您應該擇一選擇屬性來設定文件中 **ShipTo** 地址的 **addressID** 值。
- **PUNCHOUTSHIPTOUSER**–此屬性會與 **PUNCHOUTSHIPTO** 屬性共同運作。 如果 **PUNCHOUTSHIPTO** 設為 _TRUE_，系統會提取法律實體的地址。 如果 **PUNCHOUTSHIPTOUSER** 設定為 _TRUE_，系統會使用 PunchOut 使用者的主要地址，而不是法律實體地址。

### <a name="activate-the-external-catalog"></a>啟用外部目錄

設定完所有屬性，並設定外部目錄的其他設定後，請返回 **外部目錄** 頁面的 **一般** FastTab ，並將 **使用中** 選項設為 *是*。

### <a name="attach-notes-to-a-purchase-order"></a><a name="attach-po-notes"></a>將附註附加到訂購單

如同 [設定訂單屬性](#set-order-properties)章節的說明，如果您希望交付的 cXML 包含附加到相關訂購單和/或供應商記錄的附註文字，您可以在外部目錄設定中將 **POCOMMENTS** 和/或 **VENDCOMMENTS** 屬性設為 _TRUE_。 本節將詳細說明系統如何選擇和處理這些附件 (如果您有使用)。

若要設定系統尋找的附註類型，請前往 **採購和開源\>設定\>表單\>表單設定**。 然後，在 **訂購單** 索引標籤上，設定 **包括文件類型** 欄位加入到您想要納入的附註類型。 只包含文字附註，不包含文件附件。

![表單設定頁面。](media/cxml-form-setup.png "表單設定頁面")

只有當附件的 **類型** 欄位設定為您在 **包含文件類型** 欄位中選取的值，且附件的 **限制** 欄位設為 _外部_ 時，附件才會納入訂購單中。 若要建立、查看或編輯訂購單的附件，請前往 **採購和開源\>所有訂購單**，選取或建立訂購單，然後選取右上角的 **附件** 按鈕 (迴紋針符號)。

![設定為傳送給供應商的附加附註。](media/cxml-note-to-vendor.png "設定為傳送給供應商的附加附註")

## <a name="view-the-cxml-cart-message-log-for-external-catalog-punchout"></a><a name="message-log"></a>查看外部目錄 PunchOut 的 cXML 購物車訊息記錄

如果您將外部目錄的 **Punchout 通訊協定類型** 欄位設為 _cXML_，系統則會擷取從供應商傳回的購物車訊息記錄。 此記錄可用於疑難排解和其他資料用途。

若要開啟外部目錄的記錄，請選取相關目錄，然後在動作窗格中選取 **cXML 購物車訊息記錄**。 **cXML 購物車訊息記錄** 頁面顯示已傳回的購物車清單、與這些購物車相關的 XML，以及在相關採購申請上建立的文字行。

![cXML 購物車訊息記錄頁面。](media/cxml-cart-message-log.png "cXML 購物車訊息記錄頁面")

## <a name="set-the-extrinsic-elements-for-external-catalog-punchout"></a>為外部目錄 PunchOut 設定外部元素

當您將外部目錄的 **Punchout 通訊協定類型** 欄位設為 *cXML* 時，您可以新增要插入至要求 XML 訊息中正確位置的自訂外部元素。

若要將外部元素新增至外部目錄，請按照以下步驟操作。

1. 前往 **採購和開源\>目錄\>外部目錄**。
1. 選擇相關的目錄。
1. 在 **外部** 部分中的 **訊息格式** FastTab 上，選取 **新增** 來為要包含的每個外部元素在網格中新增列。 在每一個列上，設定下列欄位：

    - **名稱** – 輸入元素名稱。 這個值會成為由各列建立的 **外部** XML 元素的 **名稱** 屬性值。 一般來說，您會與供應商一起針對每個外部元素的命名達成共識。
    - **值**–為元素選擇一個值。 這個值會成為由各列建立的外部 XML 元素的值。 以下是可供使用的值：

        - **使用者名稱** – 使用進行 PunchOut 之使用者的名稱。 此名稱是 Supply Chain Management 的登入名稱。
        - **使用者電子郵件** – 使用執行 PunchOut 之使用者的電子郵件地址。 這個地址是使用者在 **使用者選項** 頁面的 **帳戶** 索引標籤上設定的地址。
        - **隨機值**–使用不重複的隨機值。
        - **使用者全名**–使用與存取外部目錄的使用者相關的聯絡人全名。
        - **名字**–使用與存取外部目錄的使用者相關的聯絡人名字。
        - **姓氏**–使用與存取外部目錄的使用者相關的聯絡人姓氏。
        - **電話號碼** – 使用與存取外部目錄的使用者相關的聯絡人主要電話號碼。

![外部元素設定。](media/cxml-extrinsics.png "外部元素設定")

使用者或管理員不會看到外部元素，因為系統只會在使用者執行 PunchOut 時才會新增這些元素。 系統會在 cXML 設定要求訊息中的 **BuyerCookie** 和 **BrowserFromPost** 元素之間自動插入外部元素。 因此，您不必在設定外部目錄時，在 XML 中手動設定外部元素。

![將外部元素新增至 XML。](media/cxml-extrinsics-xml.png "將外部元素新增至 XML")

## <a name="create-and-process-a-purchase-order"></a><a name="create-po"></a>建立和處理訂購單

當您為供應商建立訂購單時，訂購單會繼承供應商的 **透過 cXML 傳送訂購單** 選項中的設定。 但是，該設定仍可在訂購單的 **標題** 檢視中的 **設定** FastTab 中存取，以便您日後可以根據需要進行更改。

![將訂購單設為使用 cXML。](media/cxml-purchase-order.png "將訂購單設為使用 cXML")

當您從來自 PunchOut 流程的採購申請建立訂購單時，系統會填寫所有必要的明細詳細資料。 接著，您可以手動新增訂購單明細或從其他訂購單中複製這些明細。 請務必設定所有的必填欄位。 這些必填欄位包括外部參考編號，這些是將在 cXML 訊息中使用的供應商編號。

![外部參考編號範例。](media/cxml-line-details.png "外部參考編號範例")

填寫完訂購單的所有詳細資料後，請務必確認訂購單。 除非訂購單獲得確認，否則系統不會傳送任何訊息。 若要確認訂購單，請在 **動作** 群組中 **採購** 索引標籤上的動作窗格中，選取 **確認**。 

確認訂購單後，您可以透過 **訂購單確認** 日記帳查看確認狀態。 請在 **日記帳** 群組中 **採購** 索引標籤上的動作窗格中，選取 **訂購單確認**。

每個訂購單可以有多個確認。 每個確認都標有一個遞增數字。 在下圖中，訂購單是 *00000275*，確認則是 *00000275-1*。 此編號反映了標準 Supply Chain Management 的功能，其中訂購單的更改以及因此應傳送給供應商的 cXML 訊息類型，會根據確認進行識別。 如圖所示，**訂購單確認** 頁面也包含 **訂單傳送狀態** 和 **訂單要求供應商狀態** 欄位。 若要進一步瞭解此頁面上可能顯示的各種狀態值，請參閱本主題後面的[監控訂購單要求](#monitor-po-requests)章節。

![訂購單確認頁面。](media/cxml-po-confirmations.png "訂購單確認頁面")

若要查看文件的更多相關資訊，請選取網格上方的 **訂購單要求**。

**訂購單要求** 頁面包含兩個網格。 頁面上半部分的網格針對每個標記為傳送的訂購單提供一筆記錄。 頁面下半部分的 **訂購單要求歷程** 索引標籤上的網格，則可能包含所選訂購單的多筆記錄，以顯示每個確認的狀態。 下圖顯示上半部分網格中的訂購單 00000275，以及 **訂購單要求歷程** 索引標籤上的文件 00000275-1。

![訂購單要求頁面。](media/cxml-po-request.png "訂購單要求頁面")

如果批次工作已完成設定且正在運行，系統將會傳送文件。 您可以在傳送文件後查看狀態變更。 在下圖中，**訂單傳送狀態** 欄位設為 _已傳送_。 **訂單要求供應商狀態** 欄位設為 _已確認_，表示供應商已收到該份文件，且能閱讀該文件並將其儲存在系統中。 **訂購單要求歷程** 索引標籤上的網格顯示文件傳送的時間。 若要進一步瞭解此頁面上可能顯示的各種狀態值，請參閱的[監控訂購單要求](#monitor-po-requests)章節。

![訂購單要求頁面上的狀態訊息。](media/cxml-po-request-2.png "訂購單要求頁面上的狀態訊息")

## <a name="schedule-the-purchase-order-request-batch-job"></a><a name="po-batch"></a>安排訂購單要求批次工作

若要啟用傳送訂購單要求的批次工作，請前往 **採購和開源\>設定\>cXML 管理\>訂購單要求**，然後在 **批次** 群組中 **訂購單要求** 索引標籤的動作窗格上，選取 **提交工作** 以開啟 **採購要求準備和傳送** 對話方塊。 您可以使用此對話方塊設定週期，就像您平常在 Supply Chain Management 中為批次工作所做的設定。 根據您的訂單量選取間隔。 儘管您可以每分鐘執行一次批次工作，但最好在整個工作日內根據與供應商排程相符的訂單接收期間傳送批次工作。

舉例來說，假設供應商的政策規定下午 1 點前收到的所有訂單會在同一天出貨。 在這種情況下，您可能只需要在早上執行幾次批次工作，以傳遞您擁有的任何訂單。 剩下的訂單會接著在第二天傳送。 這個決定純粹屬於商業決策。 您可以加以檢視並據此為其設定參數。

系統程序會尋找狀態為 *等待* 的訂購單要求。 如果您有必須立即傳送給供應商的訂單，則可以選擇 **提交工作** 並將 **批次處理** 選項設為 *否*。

## <a name="monitor-purchase-order-requests"></a><a name="monitor-po-requests"></a>監控訂購單要求

### <a name="view-the-status-of-a-purchase-order"></a>查看訂購單的狀態

可透過 cXML 傳送的訂單經過確認後，就會進入 _等待_ 狀態。 如同 [建立和處理訂購單](#create-po)章節所述，您可以在 **訂購單要求** 頁面上查看訂購單狀態。 每個訂購單要求可以為多種狀態的其中一者，實際取決於參數和資料。 本節說明各種狀態類型及其可具備的值。 這項資訊可協助您管理問題，並瞭解訂購單狀態。

![訂購單要求頁面上的訂購單狀態。](media/cxml-monitor-po-request.png "訂購單要求頁面上的訂購單狀態")

**訂購單要求** 頁面上半部分的網格可能會顯示以下狀態值：

- **訂單傳送狀態** – 此欄位可以具有以下值之一：

    - **等待**– 文件正在等待傳送。
    - **已傳送**– 文件已傳送。
    - **停止**– 文件在傳送前標記為 _停止_。 (若要將文件標記為 _停止_，請選擇 **採購要求** 頁面的動作窗格中選取 **停止**。)
    - **封存**– 文件已遭清除。 (若要清除文件，請選擇 **採購要求** 頁面的動作窗格中選取 **清除**。)

- **訂單要求狀態** – 此欄位可以具有以下值之一：

    - **等待**– 文件正在等待傳送。
    - **已確認**– 供應商已收到並確認該文件。 您可以透過選取頁面下半部分的 **回應 XML** 索引標籤，查看從供應商傳回的詳細 XML 訊息。
    - **錯誤**– 文件已傳送給供應商，但發生錯誤。 您可以透過選取頁面下半部分的 **回應 XML** 索引標籤，查看錯誤訊息。

**訂購單要求** 頁面下半部分的 **訂購單要求歷程** 索引標籤網格可能會顯示以下值：

- **訂單要求類型** – 此欄位可以具有以下值之一：

    - **新**– 訂購單確認後，該明細立即標記為新明細。
    - **更新**– 如果供應商已傳送並認可確認，則下一個確認將會標記為 _更新_。 只有當 [全域 cXML 參數](#cxml-parameters)中的 **傳送採購要求更新** 選項設為 *是* 時，系統才會傳送更新。
    - **刪除** – 如果供應商已傳送並認可確認，但訂購單遭到取消，正在等候的確認將會標記為 _刪除_。 只有當 [全域 cXML 參數](#cxml-parameters)中的 **傳送採購要求刪除** 選項設為 *是* 時，系統才會傳送刪除。

- **要求時間** – 建立訂單確認的時間。 您可以將要求時間與訂單狀態時間進行比較，以確定確認和供應商確認之間的時間。
- **訂單傳送狀態**– 此欄位與頁面上半部分的 **訂單傳送狀態** 欄位相同。 在這裡重複欄位的目的是為了更容易在確認級別查看狀態。 如果 **訂單要求類型** 欄位設為 *新*，且在傳送確認前重新確認訂購單，**訂單傳送狀態** 欄位就會設為 *封存*。
- **訂單狀態時間** – 訂購單要求歷程最後一次更新的時間。 (更新包含狀態變更。)
- **訂單要求供應商狀態** – 此欄位與頁面上半部分的 **訂單要求供應商狀態** 欄位相同。 在這裡重複欄位的目的是為了更容易在確認級別查看狀態。
- **重新提交時間**– 重新提交記錄的時間。
- **重新提交計數** – 重新提交記錄的次數。 較高的數字表示多次失敗，因此可能表示您的資料設定或供應商的資料設定有問題。

### <a name="view-the-xml-for-a-purchase-order-request-message"></a>查看訂購單要求訊息的 XML

若要查看採購訂單要求訊息的 XML，請選取 **訂購單要求** 頁面底部的 **要求 XML 文字** 索引標籤。 在測試或錯誤驗證期間，此索引標籤上的資訊可能會有所幫助。 為了使資訊更易於閱讀，您可以將其轉換成格式化訊息。 請將索引標籤上的內容複製到文字檔，然後在 XML 編輯器中查看該文字檔。

![要求 XML 文字索引標籤。](media/cxml-request-xml-text.png "要求 XML 文字索引標籤")

### <a name="view-the-details-of-the-vendor-response"></a>查看供應商回應的詳細資料

若要查看供應商確認或錯誤回應的內容，請選取 **訂購單要求** 頁面底部的 **回應 XML** 索引標籤。

![回應 XML 索引標籤。](media/cxml-response-xml.png "回應 XML 索引標籤")

## <a name="additional-resources"></a>其他資源

- [設定 PunchOut 電子採購的外部目錄](set-up-external-catalog-for-punchout.md)
- [對發包電子採購使用外部目錄](use-external-catalogs-for-punchout.md)


[!INCLUDE[footer-include](../../includes/footer-banner.md)]
