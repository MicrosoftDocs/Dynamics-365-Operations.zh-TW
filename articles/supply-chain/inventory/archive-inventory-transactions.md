---
title: 封存庫存交易
description: 本主題說明封存庫存交易資料的方式，可幫助提高系統效能。
author: yufeihuang
ms.date: 03/01/2021
ms.topic: article
ms.prod: ''
ms.technology: ''
ms.search.form: InventTransArchiveProcessForm
audience: Application User
ms.reviewer: kamaybac
ms.search.region: Global
ms.author: yufeihuang
ms.search.validFrom: 2021-03-01
ms.dyn365.ops.version: 10.0.18
ms.openlocfilehash: 99a7b61d9bd5e1e2bd8d2c7df34882646bb51270
ms.sourcegitcommit: 3b87f042a7e97f72b5aa73bef186c5426b937fec
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/29/2021
ms.locfileid: "8448014"
---
# <a name="archive-inventory-transactions"></a>封存庫存交易

[!include [banner](../../includes/banner.md)]

隨著時間的推移，庫存交易資料表 (`InventTrans`) 將繼續增長並消耗更多的資料庫空間。 因此，對資料表的查詢將逐漸變慢。 本主題說明如何使用 *庫存交易封存* 功能，封存庫存交易的資料提高系統性能的功能。

> [!NOTE]
> 在選定的關閉分類帳期間，只有財務已更新的庫存交易才能封存。 若要封存，財務更新的出庫庫存交易必須有一個出貨狀態 *賣*，並且入站庫存交易的收貨狀態必須為 *已購買*.

當您封存庫存交易時，所有相關交易都會移至`InventTransArchive`資料表。 庫存出貨交易記錄和庫存收貨交易記錄會分別封存，根據品項識別碼 (`itemId`) 和庫存維度識別碼 (`inventDimId`)的組合，並將它們放入彙總出貨和彙總收貨交易中。

如果`itemId`和`inventDimId`組合僅包含一個收貨或出貨，該交易將不會被封存。

## <a name="turn-on-the-feature-in-your-system"></a>在您的系統中啟用此功能

如果您的系統尚未包含本主題中說明的功能，請移至 [功能管理](../../fin-ops-core/fin-ops/get-started/feature-management/feature-management-overview.md)，並打開 *庫存交易封存* 功能。 請注意，此功能只要啟用就無法停用。

## <a name="things-to-consider-before-you-archive-inventory-transactions"></a>封存庫存交易之前要考慮的事項

在封存庫存交易之前，請先考慮以下業務案例，因為這些都會受到作業的影響：

- 當您從相關文件 (例如訂購單明細) 審核庫存交易時，都將顯示為已封存。 要查看封存的交易，您必須前往 **庫存管理\>定期任務\>清理\>庫存交易封存**。
- 封存期間無法取消庫存結算。 在取消庫存結算之前，您必須還原相關期間的庫存交易封存。
- 封存期間無法進行標準成本轉換。 在做標準成本轉換前，必須還原相關期間的庫存交易封存。
- 當您封存庫存交易時，以庫存交易為來源的庫存報告將受到影響。 這些報告包括存貨賬齡報告和存貨價值報告。
- 如果在封存期間的時程內執行庫存預測，則可能會受到影響。

## <a name="prerequisites"></a>先決條件

只有在滿足以下條件的期間，才能封存庫存交易：

- 分類帳期間必須結算。
- 庫存結算必須在封存的截止日期或之後執行。
- 期間必須至少比封存的起始期限日期早一年。
- 不得有任何現有的庫存重新計算。

## <a name="archive-inventory-transactions"></a>封存庫存交易

要封存庫存交易，請按照以下步驟操作。

1. 請移至 **庫存管理**\>**定期工作**\>**清理**\>**庫存交易封存**。

    **庫存交易封存** 頁面出現並顯示封存處理記錄列表。

    ![庫存交易封存頁面。](media/archive-inventory-empty.png "庫存交易封存頁面")

1. 在「動作窗格」上，選取 **庫存交易封存** 建立庫存交易封存。
1. 在 **庫存交易封存** 對話方塊內，在 **參數** 快速索引標籤上，設定以下欄位：

    - **分類帳期間結清的開始日期**–選取要包含在封存中的最早交易日期。
    - **分類帳期間結清的結束日期**–選取要包含在封存中的最晚交易日期。

    ![庫存交易封存對話方塊。](media/archive-inventory-dates.png "庫存交易封存對話方塊")

    > [!NOTE]
    > 只有符合[先決條件](#prerequisites)的期間可供選擇。

1. 在 **在背景執行** 快速索引標籤，依需要設定批次處理詳細資料。 依照 Microsoft Dynamics 365 Supply Chain Management 中批次工作的常規步驟操作。
1. 選取 **確定**。
1. 您會收到一條訊息，請您確認是否要繼續。 請先仔細閱讀訊息，如果你想繼續，請選取 **是的**。

    您會收到一條訊息，說明您的庫存交易封存作業已新增到批次佇列。 該工作現在將開始封存選定期間的庫存交易。

## <a name="view-archived-inventory-transactions"></a>查看封存的庫存交易

**庫存交易封存** 頁面顯示完整封存記錄。 網格中的每一列都顯示了封存建立日期、建立的使用者及封存狀態等資訊。

![庫存交易封存頁面上的封存記錄。](media/archive-inventory-full.png "庫存交易封存頁面上的封存記錄")

在頁面上方的下拉式清單中，選取以下任一值來篩選網格中顯示的封存：

- **現行**–僅顯示現行封存，不顯示已還原封存。
- **全部**- 顯示所有檔案，包括現行的和還原的。

以下資訊，網格中的每個封存都會提供：

- **現行**–核取符號表示封存處於現行狀態。
- **起始日期**–封存中可以包含的最早交易日期。
- **截止日期**–封存中可以包含的最晚交易日期。
- **由…排程**–建立封存的使用者帳戶。
- **執行** – 封存建立日期。
- **還原**–核取標記表示封存已還原。
- **暫停當前更新**–核取標記表示封存正在進行中，但已暫停。
- **狀態**–封存的處理狀態。 可能的值為 *等待*、*進行中*，和 *已完成*。

網格上方的工具列提供了以下按鈕，您可以用來處理選定的封存：

- **封存交易**–查看選定封存的完整詳細資料。 **封存交易** 頁面出現並顯示封存中的所有交易。

    ![封存交易頁面。](media/archive-inventory-transactions.png "封存交易頁面")

    若要在 **封存交易** 頁面查看特定交易的更多資訊，請在網格中選取它，然後在「動作窗格上」，選取 **封存交易詳情**。 **封存交易詳細資料** 頁面出現並顯示分類帳過帳、相關子分類帳參考和財務維度等資訊。

- **暫停封存**–暫停當前正在處理的已選封存。 只有在封存任務生成後，暫停才會生效。 因此，在暫停生效之前可能會有短暫的延遲。 如果封存已暫停，則 **暫停當前更新** 欄位會出現一個核取標記。
- **恢復封存**–繼續處理當前暫停的已選封存。
- **還原**–還原選定的封存。 只有當它的 **狀態** 欄位設定為 *已完成*，才能還原封存。 如果封存已還原，則 **還原** 欄位會出現一個核取標記。
